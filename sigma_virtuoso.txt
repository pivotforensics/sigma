(index="virtuoso*" ServiceName="PSEXESVC" ((extra.plaso.event_identifier="7045" ServiceFileName="*\\PSEXESVC.exe") OR extra.plaso.event_identifier="7036")) | table extra.plaso.event_identifier,CommandLine,ParentCommandLine,ServiceName,ServiceFileName
(index="virtuoso*" Image="*\\PSEXESVC.exe" User="NT AUTHORITY\\SYSTEM") | table extra.plaso.event_identifier,CommandLine,ParentCommandLine,ServiceName,ServiceFileName
(index="virtuoso*" extra.plaso.event_identifier="106") | eventstats count as val by TaskName| search val < 5
(index="virtuoso*" ((extra.plaso.event_identifier="5861" ("ActiveScriptEventConsumer" OR "CommandLineEventConsumer" OR "CommandLineTemplate")) OR extra.plaso.event_identifier="5859"))
(Signature="PHP/Backdoor" OR Signature="JSP/Backdoor" OR Signature="ASP/Backdoor" OR Signature="Backdoor.PHP" OR Signature="Backdoor.JSP" OR Signature="Backdoor.ASP" OR Signature="*Webshell*") | table FileName,User
(FileName="C:\\Windows\\Temp\\*" OR FileName="C:\\Temp\\*" OR FileName="*\\Client\\*" OR FileName="C:\\PerfLogs\\*" OR FileName="C:\\Users\\Public\\*" OR FileName="C:\\Users\\Default\\*" OR FileName="*.ps1" OR FileName="*.vbs" OR FileName="*.bat" OR FileName="*.chm" OR FileName="*.xml" OR FileName="*.txt" OR FileName="*.jsp" OR FileName="*.jspx" OR FileName="*.asp" OR FileName="*.aspx" OR FileName="*.php" OR FileName="*.war") | table Signature,User
(Signature="*MeteTool*" OR Signature="*MPreter*" OR Signature="*Meterpreter*" OR Signature="*Metasploit*" OR Signature="*PowerSploit*" OR Signature="*CobaltSrike*" OR Signature="*Swrort*") | table FileName,User
(Signature="*DumpCreds*" OR Signature="*Mimikatz*" OR Signature="*PWCrack*" OR Signature="HTool/WCE" OR Signature="*PSWtool*" OR Signature="*PWDump*") | table FileName,User
(index="virtuoso*" extra.plaso.event_identifier="13" TargetObject="*\\Software\\AppDataLow\\Software\\Microsoft\\*")
(index="virtuoso*" (extra.plaso.event_identifier="400" EngineVersion="2.*") NOT (HostVersion="2.*"))
(index="virtuoso*" ("System.Net.WebClient).DownloadString(" OR "system.net.webclient).downloadfile("))
(index="virtuoso*" "System.Reflection.Assembly.Load")
(index="virtuoso*" ("Invoke-DllInjection" OR "Invoke-Shellcode" OR "Invoke-WmiCommand" OR "Get-GPPPassword" OR "Get-Keystrokes" OR "Get-TimedScreenshot" OR "Get-VaultCredential" OR "Invoke-CredentialInjection" OR "Invoke-Mimikatz" OR "Invoke-NinjaCopy" OR "Invoke-TokenManipulation" OR "Out-Minidump" OR "VolumeShadowCopyTools" OR "Invoke-ReflectivePEInjection" OR "Invoke-UserHunter" OR "Find-GPOLocation" OR "Invoke-ACLScanner" OR "Invoke-DowngradeAccount" OR "Get-ServiceUnquoted" OR "Get-ServiceFilePermission" OR "Get-ServicePermission" OR "Invoke-ServiceAbuse" OR "Install-ServiceBinary" OR "Get-RegAutoLogon" OR "Get-VulnAutoRun" OR "Get-VulnSchTask" OR "Get-UnattendedInstallFile" OR "Get-ApplicationHost" OR "Get-RegAlwaysInstallElevated" OR "Get-Unconstrained" OR "Add-RegBackdoor" OR "Add-ScrnSaveBackdoor" OR "Gupt-Backdoor" OR "Invoke-ADSBackdoor" OR "Enabled-DuplicateToken" OR "Invoke-PsUaCme" OR "Remove-Update" OR "Check-VM" OR "Get-LSASecret" OR "Get-PassHashes" OR "Show-TargetScreen" OR "Port-Scan" OR "Invoke-PoshRatHttp" OR "Invoke-PowerShellTCP" OR "Invoke-PowerShellWMI" OR "Add-Exfiltration" OR "Add-Persistence" OR "Do-Exfiltration" OR "Start-CaptureServer" OR "Get-ChromeDump" OR "Get-ClipboardContents" OR "Get-FoxDump" OR "Get-IndexedItem" OR "Get-Screenshot" OR "Invoke-Inveigh" OR "Invoke-NetRipper" OR "Invoke-EgressCheck" OR "Invoke-PostExfil" OR "Invoke-PSInject" OR "Invoke-RunAs" OR "MailRaider" OR "New-HoneyHash" OR "Set-MacAttribute" OR "Invoke-DCSync" OR "Invoke-PowerDump" OR "Exploit-Jboss" OR "Invoke-ThunderStruck" OR "Invoke-VoiceTroll" OR "Set-Wallpaper" OR "Invoke-InveighRelay" OR "Invoke-PsExec" OR "Invoke-SSHCommand" OR "Get-SecurityPackages" OR "Install-SSP" OR "Invoke-BackdoorLNK" OR "PowerBreach" OR "Get-SiteListPassword" OR "Get-System" OR "Invoke-BypassUAC" OR "Invoke-Tater" OR "Invoke-WScriptBypassUAC" OR "PowerUp" OR "PowerView" OR "Get-RickAstley" OR "Find-Fruit" OR "HTTP-Login" OR "Find-TrustedDocuments" OR "Invoke-Paranoia" OR "Invoke-WinEnum" OR "Invoke-ARPScan" OR "Invoke-PortScan" OR "Invoke-ReverseDNSLookup" OR "Invoke-SMBScanner" OR "Invoke-Mimikittenz"))
(index="virtuoso*" "set-content" "-stream")
(index="virtuoso*" extra.plaso.event_identifier="4104" "PromptForCredential")
(index="virtuoso*" extra.plaso.event_identifier="400" (EngineVersion="2.*" OR EngineVersion="4.*" OR EngineVersion="5.*") HostVersion="3.*")
(index="virtuoso*" (" -enc " OR " -EncodedCommand ") (" -w hidden " OR " -window hidden " OR " - windowstyle hidden ") (" -noni " OR " -noninteractive "))
(index="virtuoso*" (extra.plaso.event_identifier="4104" "*AAAAYInlM*") ("*OiCAAAAYInlM*" OR "*OiJAAAAYInlM*"))
(index="virtuoso*" ("AdjustTokenPrivileges" OR "IMAGE_NT_OPTIONAL_HDR64_MAGIC" OR "Microsoft.Win32.UnsafeNativeMethods" OR "ReadProcessMemory.Invoke" OR "SE_PRIVILEGE_ENABLED" OR "LSA_UNICODE_STRING" OR "MiniDumpWriteDump" OR "PAGE_EXECUTE_READ" OR "SECURITY_DELEGATION" OR "TOKEN_ADJUST_PRIVILEGES" OR "TOKEN_ALL_ACCESS" OR "TOKEN_ASSIGN_PRIMARY" OR "TOKEN_DUPLICATE" OR "TOKEN_ELEVATION" OR "TOKEN_IMPERSONATE" OR "TOKEN_INFORMATION_CLASS" OR "TOKEN_PRIVILEGES" OR "TOKEN_QUERY" OR "Metasploit" OR "Mimikatz"))
(index="virtuoso*" extra.plaso.event_identifier="4103" "PS ATTACK!!!")
(index="virtuoso*" (" -nop -w hidden -c * [Convert]::FromBase64String" OR " -w hidden -noni -nop -c \"iex(New-Object" OR " -w hidden -ep bypass -Enc" OR "powershell.exe reg add HKCU\\software\\microsoft\\windows\\currentversion\\run" OR "bypass -noprofile -windowstyle hidden (new-object system.net.webclient).download" OR "iex(New-Object Net.WebClient).Download"))
(index="virtuoso*" CommandLine="* cl Microsoft-Windows-WMI-Activity/Trace")
(index="virtuoso*" Image="C:\\WINDOWS\\system32\\wbem\\scrcons.exe" ParentImage="C:\\Windows\\System32\\svchost.exe")
(index="virtuoso*" (Image="*\\wscript.exe" OR Image="*\\cscript.exe") (CommandLine="*.jse" OR CommandLine="*.vbe" OR CommandLine="*.js" OR CommandLine="*.vba")) | table CommandLine,ParentCommandLine
(index="virtuoso*" ((ParentImage="*\\wscript.exe" OR ParentImage="*\\cscript.exe") (Image="*\\powershell.exe")) NOT (CurrentDirectory="*\\Health Service State\\*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (Image="*\\wmic.exe") (CommandLine="*/NODE:*process call create *" OR CommandLine="* path AntiVirusProduct get *" OR CommandLine="* path FirewallProduct get *" OR CommandLine="* shadowcopy delete *")) | table CommandLine,ParentCommandLine
(index="virtuoso*" User="NT AUTHORITY\\SYSTEM" Image="*\\taskmgr.exe")
(index="virtuoso*" (CommandLine="*System.Management.Automation.AmsiUtils*") (CommandLine="*amsiInitFailed*"))
(index="virtuoso*" (Image="*\\net.exe" OR Image="*\\net1.exe") (CommandLine="* group*" OR CommandLine="* localgroup*" OR CommandLine="* user*" OR CommandLine="* view*" OR CommandLine="* share" OR CommandLine="* accounts*" OR CommandLine="* use*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" Image="*\\Microsoft.Workflow.Compiler.exe") | table CommandLine,ParentCommandLine
(index="virtuoso*" ((Image="*\\fsutil.exe" CommandLine="* deletejournal *") OR CommandLine="*\\AppData\\Local\\Temp\* \\.\\pipe\\*" OR (Image="*\\wevtutil.exe" CommandLine="* cl *") OR (Image="*\\rundll32.exe" CommandLine="*.dat,#1") OR "*\\perfc.dat*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" ProcessCommandLine="C:\\Windows\\PSEXESVC.exe")
(index="virtuoso*" (CommandLine="arp.exe" OR CommandLine="at.exe" OR CommandLine="attrib.exe" OR CommandLine="cscript.exe" OR CommandLine="dsquery.exe" OR CommandLine="hostname.exe" OR CommandLine="ipconfig.exe" OR CommandLine="mimikatz.exe" OR CommandLine="nbtstat.exe" OR CommandLine="net.exe" OR CommandLine="netsh.exe" OR CommandLine="nslookup.exe" OR CommandLine="ping.exe" OR CommandLine="quser.exe" OR CommandLine="qwinsta.exe" OR CommandLine="reg.exe" OR CommandLine="runas.exe" OR CommandLine="sc.exe" OR CommandLine="schtasks.exe" OR CommandLine="ssh.exe" OR CommandLine="systeminfo.exe" OR CommandLine="taskkill.exe" OR CommandLine="telnet.exe" OR CommandLine="tracert.exe" OR CommandLine="wscript.exe" OR CommandLine="xcopy.exe" OR CommandLine="pscp.exe" OR CommandLine="copy.exe" OR CommandLine="robocopy.exe" OR CommandLine="certutil.exe" OR CommandLine="vssadmin.exe" OR CommandLine="powershell.exe" OR CommandLine="wevtutil.exe" OR CommandLine="psexec.exe" OR CommandLine="bcedit.exe" OR CommandLine="wbadmin.exe" OR CommandLine="icacls.exe" OR CommandLine="diskpart.exe")) | eventstats count as val by MachineName| search val > 5
(index="virtuoso*" Image="*\\GUP.exe" NOT ((Image="C:\\Users\*\\AppData\\Local\\Notepad++\\updater\\gup.exe" OR Image="C:\\Users\*\\AppData\\Roaming\\Notepad++\\updater\\gup.exe" OR Image="C:\\Program Files\\Notepad++\\updater\\gup.exe" OR Image="C:\\Program Files (x86)\\Notepad++\\updater\\gup.exe")))
(index="virtuoso*" (CommandLine="vssadmin.exe delete shadows*" OR CommandLine="vssadmin delete shadows*" OR CommandLine="vssadmin create shadow /for=C:*" OR CommandLine="copy \\?\\GLOBALROOT\\Device\\*\\windows\\ntds\\ntds.dit*" OR CommandLine="copy \\?\\GLOBALROOT\\Device\\*\\config\\SAM*" OR CommandLine="reg SAVE HKLM\\SYSTEM *" OR CommandLine="reg SAVE HKLM\\SAM *" OR CommandLine="* sekurlsa:*" OR CommandLine="net localgroup adminstrators * /add" OR CommandLine="net group \"Domain Admins\" * /ADD /DOMAIN" OR CommandLine="certutil.exe *-urlcache* http*" OR CommandLine="certutil.exe *-urlcache* ftp*" OR CommandLine="netsh advfirewall firewall *\\AppData\\*" OR CommandLine="attrib +S +H +R *\\AppData\\*" OR CommandLine="schtasks* /create *\\AppData\\*" OR CommandLine="schtasks* /sc minute*" OR CommandLine="*\\Regasm.exe *\\AppData\\*" OR CommandLine="*\\Regasm *\\AppData\\*" OR CommandLine="*\\bitsadmin* /transfer*" OR CommandLine="*\\certutil.exe * -decode *" OR CommandLine="*\\certutil.exe * -decodehex *" OR CommandLine="*\\certutil.exe -ping *" OR CommandLine="icacls * /grant Everyone:F /T /C /Q" OR CommandLine="* wmic shadowcopy delete *" OR CommandLine="* wbadmin.exe delete catalog -quiet*" OR CommandLine="*\\wscript.exe *.jse" OR CommandLine="*\\wscript.exe *.js" OR CommandLine="*\\wscript.exe *.vba" OR CommandLine="*\\wscript.exe *.vbe" OR CommandLine="*\\cscript.exe *.jse" OR CommandLine="*\\cscript.exe *.js" OR CommandLine="*\\cscript.exe *.vba" OR CommandLine="*\\cscript.exe *.vbe" OR CommandLine="*\\fodhelper.exe" OR CommandLine="*waitfor*/s*" OR CommandLine="*waitfor*/si persist*" OR CommandLine="*remote*/s*" OR CommandLine="*remote*/c*" OR CommandLine="*remote*/q*" OR CommandLine="*AddInProcess*" OR CommandLine="* /stext *" OR CommandLine="* /scomma *" OR CommandLine="* /stab *" OR CommandLine="* /stabular *" OR CommandLine="* /shtml *" OR CommandLine="* /sverhtml *" OR CommandLine="* /sxml *"))
(index="virtuoso*" (Image="*\\sdbinst.exe") (CommandLine="*\\AppPatch\\*}.sdb*"))
(index="virtuoso*" (CommandLine="vssadmin.exe Delete Shadows" OR CommandLine="vssadmin create shadow /for=C:" OR CommandLine="copy \\?\\GLOBALROOT\\Device\\*\\windows\\ntds\\ntds.dit" OR CommandLine="copy \\?\\GLOBALROOT\\Device\\*\\config\\SAM" OR CommandLine="vssadmin delete shadows /for=C:" OR CommandLine="reg SAVE HKLM\\SYSTEM " OR CommandLine="esentutl.exe /y /vss *\\ntds.dit*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" Image="*\\svchost.exe" NOT ((ParentImage="*\\services.exe" OR ParentImage="*\\MsMpEng.exe" OR ParentImage="*\\Mrt.exe" OR ParentImage="*\\rpcnet.exe"))) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="*netsh firewall add*"))
(index="virtuoso*" Description="Windows PowerShell" NOT ((index="virtuoso*" ((Image="*\\powershell.exe" OR Image="*\\powershell_ise.exe") OR Description="Windows PowerShell ISE"))))
(index="virtuoso*" (CommandLine="* -e JAB*" OR CommandLine="* -enc JAB*" OR CommandLine="* -encodedcommand JAB*" OR CommandLine="* BA^J e-" OR CommandLine="* -e SUVYI*" OR CommandLine="* -e aWV4I*" OR CommandLine="* -e SQBFAFgA*" OR CommandLine="* -e aQBlAHgA*" OR CommandLine="* -enc SUVYI*" OR CommandLine="* -enc aWV4I*" OR CommandLine="* -enc SQBFAFgA*" OR CommandLine="* -enc aQBlAHgA*") NOT (CommandLine="* -ExecutionPolicy remotesigned *"))
(index="virtuoso*" Image="*\\powershell.exe" CommandLine="* hidden *" (CommandLine="*AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA*" OR CommandLine="*aXRzYWRtaW4gL3RyYW5zZmVy*" OR CommandLine="*IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA*" OR CommandLine="*JpdHNhZG1pbiAvdHJhbnNmZX*" OR CommandLine="*YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg*" OR CommandLine="*Yml0c2FkbWluIC90cmFuc2Zlc*" OR CommandLine="*AGMAaAB1AG4AawBfAHMAaQB6AGUA*" OR CommandLine="*JABjAGgAdQBuAGsAXwBzAGkAegBlA*" OR CommandLine="*JGNodW5rX3Npem*" OR CommandLine="*QAYwBoAHUAbgBrAF8AcwBpAHoAZQ*" OR CommandLine="*RjaHVua19zaXpl*" OR CommandLine="*Y2h1bmtfc2l6Z*" OR CommandLine="*AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A*" OR CommandLine="*kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg*" OR CommandLine="*lPLkNvbXByZXNzaW9u*" OR CommandLine="*SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA*" OR CommandLine="*SU8uQ29tcHJlc3Npb2*" OR CommandLine="*Ty5Db21wcmVzc2lvb*" OR CommandLine="*AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ*" OR CommandLine="*kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA*" OR CommandLine="*lPLk1lbW9yeVN0cmVhb*" OR CommandLine="*SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A*" OR CommandLine="*SU8uTWVtb3J5U3RyZWFt*" OR CommandLine="*Ty5NZW1vcnlTdHJlYW*" OR CommandLine="*4ARwBlAHQAQwBoAHUAbgBrA*" OR CommandLine="*5HZXRDaHVua*" OR CommandLine="*AEcAZQB0AEMAaAB1AG4Aaw*" OR CommandLine="*LgBHAGUAdABDAGgAdQBuAGsA*" OR CommandLine="*LkdldENodW5r*" OR CommandLine="*R2V0Q2h1bm*" OR CommandLine="*AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A*" OR CommandLine="*QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA*" OR CommandLine="*RIUkVBRF9JTkZPNj*" OR CommandLine="*SFJFQURfSU5GTzY0*" OR CommandLine="*VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA*" OR CommandLine="*VEhSRUFEX0lORk82N*" OR CommandLine="*AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA*" OR CommandLine="*cmVhdGVSZW1vdGVUaHJlYW*" OR CommandLine="*MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA*" OR CommandLine="*NyZWF0ZVJlbW90ZVRocmVhZ*" OR CommandLine="*Q3JlYXRlUmVtb3RlVGhyZWFk*" OR CommandLine="*QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA*" OR CommandLine="*0AZQBtAG0AbwB2AGUA*" OR CommandLine="*1lbW1vdm*" OR CommandLine="*AGUAbQBtAG8AdgBlA*" OR CommandLine="*bQBlAG0AbQBvAHYAZQ*" OR CommandLine="*bWVtbW92Z*" OR CommandLine="*ZW1tb3Zl*"))
(index="virtuoso*" ((Image="*\\tasksche.exe" OR Image="*\\mssecsvc.exe" OR Image="*\\taskdl.exe" OR Image="*\\@WanaDecryptor@*" OR Image="*\\WanaDecryptor*" OR Image="*\\taskhsvc.exe" OR Image="*\\taskse.exe" OR Image="*\\111.exe" OR Image="*\\lhdfrgui.exe" OR Image="*\\diskpart.exe" OR Image="*\\linuxnew.exe" OR Image="*\\wannacry.exe") OR (CommandLine="*icacls * /grant Everyone:F /T /C /Q*" OR CommandLine="*bcdedit /set {default} recoveryenabled no*" OR CommandLine="*wbadmin delete catalog -quiet*" OR CommandLine="*@Please_Read_Me@.txt*"))) | table CommandLine,ParentCommandLine
(index="virtuoso*" Image="*\\powershell.exe" (CommandLine="*new-object system.net.webclient).downloadstring(*" OR CommandLine="*new-object system.net.webclient).downloadfile(*" OR CommandLine="*new-object net.webclient).downloadstring(*" OR CommandLine="*new-object net.webclient).downloadfile(*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (Image="*\\setspn.exe" OR Description="*Query or reset the computer* SPN attribute*") CommandLine="*-q*")
(index="virtuoso*" CommandLine="*transport=dt_socket,address=*" NOT (CommandLine="*address=127.0.0.1*" OR CommandLine="*address=localhost*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="*\\svchost.exe C:\\Users\\*\\Desktop\\*" OR (ParentImage="*\\svchost.exe*" (CommandLine="*whoami.exe /all" OR CommandLine="*net.exe view"))))
(index="virtuoso*" (Image="*\\attrib.exe" CommandLine="* +h *") NOT ((index="virtuoso*" (CommandLine="*\\desktop.ini *" OR (ParentImage="*\\cmd.exe" CommandLine="+R +H +S +A \\*.cui" ParentCommandLine="C:\\WINDOWS\\system32\\*.bat"))))) | table CommandLine,ParentCommandLine,User
(index="virtuoso*" (CommandLine="*\\msdt.exe*" OR CommandLine="*\\installutil.exe*" OR CommandLine="*\\regsvcs.exe*" OR CommandLine="*\\regasm.exe*" OR CommandLine="*\\regsvr32.exe*" OR CommandLine="*\\msbuild.exe*" OR CommandLine="*\\ieexec.exe*" OR CommandLine="*\\mshta.exe*"))
(index="virtuoso*" (CommandLine="* msiexec*:\\/\\/*"))
(index="virtuoso*" (ParentImage="*\\WINWORD.EXE" OR ParentImage="*\\EXCEL.EXE" OR ParentImage="*\\POWERPNT.exe" OR ParentImage="*\\MSPUB.exe" OR ParentImage="*\\VISIO.exe" OR ParentImage="*\\OUTLOOK.EXE") (Image="C:\\users\*.exe")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="*\\sysprep.exe *\\AppData\\*" OR CommandLine="sysprep.exe *\\AppData\\*"))
(index="virtuoso*" Image="*\\csc.exe*" (ParentImage="*\\wscript.exe" OR ParentImage="*\\cscript.exe" OR ParentImage="*\\mshta.exe"))
(index="virtuoso*" (CommandLine="*EnableUnsafeClientMailRules*" OR (ParentImage="*\\outlook.exe" CommandLine="\\\\*\\*.exe")))
(index="virtuoso*" (ParentImage="*\\wmiprvse.exe") (Image="*\\powershell.exe"))
(index="virtuoso*" (ParentImage="*\\System32\\control.exe" CommandLine="*\\rundll32.exe *") NOT (CommandLine="*Shell32.dll*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" CommandLine="*\\SYSVOL\\*\\policies\\*")
(index="virtuoso*" ParentImage="*\\WINWORD.EXE" Image="*\\MicroScMgmt.exe ")
(index="virtuoso*" (Image="*\\bitsadmin.exe") (CommandLine="/transfer")) | table CommandLine,ParentCommandLine
(index="virtuoso*" Image="*\\cmdkey.exe" CommandLine="* /list *") | table CommandLine,ParentCommandLine,User
(index="virtuoso*" (Image="*\\Powershell.exe") (CommandLine=" -windowstyle h " OR CommandLine=" -windowstyl h" OR CommandLine=" -windowsty h" OR CommandLine=" -windowst h" OR CommandLine=" -windows h" OR CommandLine=" -windo h" OR CommandLine=" -wind h" OR CommandLine=" -win h" OR CommandLine=" -wi h" OR CommandLine=" -win h " OR CommandLine=" -win hi " OR CommandLine=" -win hid " OR CommandLine=" -win hidd " OR CommandLine=" -win hidde " OR CommandLine=" -NoPr " OR CommandLine=" -NoPro " OR CommandLine=" -NoProf " OR CommandLine=" -NoProfi " OR CommandLine=" -NoProfil " OR CommandLine=" -nonin " OR CommandLine=" -nonint " OR CommandLine=" -noninte " OR CommandLine=" -noninter " OR CommandLine=" -nonintera " OR CommandLine=" -noninterac " OR CommandLine=" -noninteract " OR CommandLine=" -noninteracti " OR CommandLine=" -noninteractiv " OR CommandLine=" -ec " OR CommandLine=" -encodedComman " OR CommandLine=" -encodedComma " OR CommandLine=" -encodedComm " OR CommandLine=" -encodedCom " OR CommandLine=" -encodedCo " OR CommandLine=" -encodedC " OR CommandLine=" -encoded " OR CommandLine=" -encode " OR CommandLine=" -encod " OR CommandLine=" -enco " OR CommandLine=" -en "))
(index="virtuoso*" CommandLine="whoami")
(index="virtuoso*" (Image="*\\svchost.exe" OR Image="*\\taskhost.exe" OR Image="*\\lsm.exe" OR Image="*\\lsass.exe" OR Image="*\\services.exe" OR Image="*\\lsaiso.exe" OR Image="*\\csrss.exe" OR Image="*\\wininit.exe" OR Image="*\\winlogon.exe") NOT ((ParentImage="*\\System32\*" OR ParentImage="*\\SysWOW64\*")))
(index="virtuoso*" (Image="*:\\RECYCLER\\*" OR Image="*:\\SystemVolumeInformation\\*" OR Image="C:\\Windows\\Tasks\\*" OR Image="C:\\Windows\\debug\\*" OR Image="C:\\Windows\\fonts\\*" OR Image="C:\\Windows\\help\\*" OR Image="C:\\Windows\\drivers\\*" OR Image="C:\\Windows\\addins\\*" OR Image="C:\\Windows\\cursors\\*" OR Image="C:\\Windows\\system32\\tasks\\*"))
(index="virtuoso*" (Image="*\\wwwroot\\*" OR Image="*\\wmpub\\*" OR Image="*\\htdocs\\*") NOT ((Image="*bin\\*" OR Image="*\\Tools\\*" OR Image="*\\SMSComponent\\*") (ParentImage="*\\services.exe"))) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="* /c powershell*\\AppData\\Local\\*" OR CommandLine="* /c powershell*\\AppData\\Roaming\\*"))
(index="virtuoso*" (CommandLine="tasklist" OR CommandLine="net time" OR CommandLine="systeminfo" OR CommandLine="whoami" OR CommandLine="nbtstat" OR CommandLine="net start" OR CommandLine="*\\net1 start" OR CommandLine="qprocess" OR CommandLine="nslookup" OR CommandLine="hostname.exe" OR CommandLine="*\\net1 user /domain" OR CommandLine="*\\net1 group /domain" OR CommandLine="*\\net1 group \"domain admins\" /domain" OR CommandLine="*\\net1 group \"Exchange Trusted Subsystem\" /domain" OR CommandLine="*\\net1 accounts /domain" OR CommandLine="*\\net1 user net localgroup administrators" OR CommandLine="netstat -an")) | eventstats count as val by CommandLine| search val > 4
(index="virtuoso*" (Image="*\\schtasks.exe" CommandLine="* /create *") NOT (User="NT AUTHORITY\\SYSTEM")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (ParentImage="*\\apache*" OR ParentImage="*\\tomcat*" OR ParentImage="*\\w3wp.exe" OR ParentImage="*\\php-cgi.exe" OR ParentImage="*\\nginx.exe" OR ParentImage="*\\httpd.exe") (CommandLine="whoami" OR CommandLine="net user" OR CommandLine="ping -n" OR CommandLine="systeminfo")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="netsh interface portproxy add v4tov4 *"))
(index="virtuoso*" ((Image="*\\wscript.exe" OR Image="*\\cscript.exe") (CommandLine="* C:\\Users\\*.jse *" OR CommandLine="* C:\\Users\\*.vbe *" OR CommandLine="* C:\\Users\\*.js *" OR CommandLine="* C:\\Users\\*.vba *" OR CommandLine="* C:\\Users\\*.vbs *" OR CommandLine="* C:\\ProgramData\\*.jse *" OR CommandLine="* C:\\ProgramData\\*.vbe *" OR CommandLine="* C:\\ProgramData\\*.js *" OR CommandLine="* C:\\ProgramData\\*.vba *" OR CommandLine="* C:\\ProgramData\\*.vbs *")) NOT (ParentImage="*\\winzip*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="certutil -f -encode *" OR CommandLine="certutil.exe -f -encode *" OR CommandLine="certutil -encode -f *" OR CommandLine="certutil.exe -encode -f *"))
(index="virtuoso*" ParentImage="*\\WINWORD.EXE" Image="*\\csc.exe")
(index="virtuoso*" (Image="*\\update.exe") (CommandLine="*--processStart*.exe*" OR CommandLine="*–createShortcut*.exe*"))
(index="virtuoso*" (ParentImage="*\\WINWORD.EXE" OR ParentImage="*\\EXCEL.EXE" OR ParentImage="*\\POWERPNT.exe" OR ParentImage="*\\MSPUB.exe" OR ParentImage="*\\VISIO.exe" OR ParentImage="*\\OUTLOOK.EXE") (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\scrcons.exe" OR Image="*\\schtasks.exe" OR Image="*\\regsvr32.exe" OR Image="*\\hh.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\rundll32.exe" OR Image="*\\msiexec.exe" OR Image="*\\forfiles.exe" OR Image="*\\scriptrunner.exe" OR Image="*\\mftrace.exe" OR Image="*\\AppVLP.exe" OR Image="*\\svchost.exe")) | table CommandLine,ParentCommandLine
(index="virtuoso*" CommandLine="*AAAAYInlM*" (CommandLine="*OiCAAAAYInlM*" OR CommandLine="*OiJAAAAYInlM*"))
(index="virtuoso*" ((Image="*\\regsvr32.exe" CommandLine="*\\Temp\\*") OR (Image="*\\regsvr32.exe" ParentImage="*\\powershell.exe") OR (Image="*\\regsvr32.exe" (CommandLine="*/i:http* scrobj.dll" OR CommandLine="*/i:ftp* scrobj.dll")) OR (Image="*\\wscript.exe" ParentImage="*\\regsvr32.exe") OR (Image="*\\EXCEL.EXE" CommandLine="*..\\..\\..\\Windows\\System32\\regsvr32.exe *"))) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="*vssadmin delete shadows*" OR CommandLine="*wmic SHADOWCOPY DELETE*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (ParentImage="*\\w3wp.exe" OR ParentImage="*\\httpd.exe" OR ParentImage="*\\nginx.exe" OR ParentImage="*\\php-cgi.exe") (Image="*\\cmd.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\powershell.exe")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="*\\calc.exe *" OR (index="virtuoso*" Image="*\\calc.exe" NOT (Image="*\\Windows\\Sys*"))))
(index="virtuoso*" (CommandLine="* -ma *") (CommandLine="* lsass.exe*"))
(index="virtuoso*" (Image="*\\svchost.exe" OR Image="*\\rundll32.exe" OR Image="*\\services.exe" OR Image="*\\powershell.exe" OR Image="*\\regsvr32.exe" OR Image="*\\spoolsv.exe" OR Image="*\\lsass.exe" OR Image="*\\smss.exe" OR Image="*\\csrss.exe" OR Image="*\\conhost.exe" OR Image="*\\wininit.exe" OR Image="*\\lsm.exe" OR Image="*\\winlogon.exe" OR Image="*\\explorer.exe" OR Image="*\\taskhost.exe") NOT ((Image="C:\\Windows\\System32\*" OR Image="C:\\Windows\\SysWow64\*" OR Image="C:\\Windows\\explorer.exe" OR Image="C:\\Windows\\winsxs\*")))
(index="virtuoso*" (Image="*\\$Recycle.bin" OR Image="*\\Users\\All Users\\*" OR Image="*\\Users\\Default\\*" OR Image="*\\Users\\Public\\*" OR Image="C:\\Perflogs\\*" OR Image="*\\config\\systemprofile\\*" OR Image="*\\Windows\\Fonts\\*" OR Image="*\\Windows\\IME\\*" OR Image="*\\Windows\\addins\\*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="* asreproast *" OR CommandLine="* dump /service:krbtgt *" OR CommandLine="* kerberoast *" OR CommandLine="* createnetonly /program:*" OR CommandLine="* ptt /ticket:*" OR CommandLine="* /impersonateuser:*" OR CommandLine="* renew /ticket:*" OR CommandLine="* asktgt /user:*" OR CommandLine="* harvest /interval:*"))
(index="virtuoso*" (CommandLine="*\\APPCMD.EXE install module /name:*"))
(index="virtuoso*" (Image="C:\\PerfLogs\\*" OR Image="C:\\$Recycle.bin\\*" OR Image="C:\\Intel\\Logs\\*" OR Image="C:\\Users\\Default\\*" OR Image="C:\\Users\\Public\\*" OR Image="C:\\Users\\NetworkService\\*" OR Image="C:\\Windows\\Fonts\\*" OR Image="C:\\Windows\\Debug\\*" OR Image="C:\\Windows\\Media\\*" OR Image="C:\\Windows\\Help\\*" OR Image="C:\\Windows\\addins\\*" OR Image="C:\\Windows\\repair\\*" OR Image="C:\\Windows\\security\\*" OR Image="*\\RSA\\MachineKeys\\*" OR Image="C:\\Windows\\system32\\config\\systemprofile\\*"))
(index="virtuoso*" ParentImage="*\\EQNEDT32.EXE") | table CommandLine
(index="virtuoso*" (CommandLine="* -decode *" OR CommandLine="* /decode *" OR CommandLine="* -decodehex *" OR CommandLine="* /decodehex *" OR CommandLine="* -urlcache *" OR CommandLine="* /urlcache *" OR CommandLine="* -verifyctl *" OR CommandLine="* /verifyctl *" OR CommandLine="* -encode *" OR CommandLine="* /encode *" OR CommandLine="*certutil* -URL*" OR CommandLine="*certutil* /URL*" OR CommandLine="*certutil* -ping*" OR CommandLine="*certutil* /ping*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="* cl */Trace*" OR CommandLine="* clear-log */Trace*" OR CommandLine="* sl* /e:false*" OR CommandLine="* set-log* /e:false*"))
(index="virtuoso*" (CommandLine="* -bxor*"))
(index="virtuoso*" (index="virtuoso*" (Product="*PAExec*") (Imphash="11D40A7B7876288F919AB819CC2D9802" OR Imphash="6444f8a34e99b8f7d9647de66aabe516" OR Imphash="dfd6aa3f7b2b1035b76b718f1ddc689f" OR Imphash="1a6cca4d5460b1710a12dea39e4a592c")) NOT (Image="*paexec*"))
(index="virtuoso*" CommandLine="* /INJECTRUNNING *")
(index="virtuoso*" (Image="*\\$Recycle.bin" OR Image="*\\Users\\Public\\*" OR Image="C:\\Perflogs\\*" OR Image="*\\Windows\\Fonts\\*" OR Image="*\\Windows\\IME\\*" OR Image="*\\Windows\\addins\\*" OR Image="*\\Windows\\debug\\*"))
(index="virtuoso*" User="NT AUTHORITY\\SYSTEM" Image="*\\tscon.exe")
(index="virtuoso*" ParentCommandLine="*\\DllHost.exe" (ParentCommandLine="*\\{3E5FC7F9-9A51-4367-9063-A120244FBEC7}" OR ParentCommandLine="*\\{3E000D72-A845-4CD9-BD83-80C07C3B881F}")) | table CommandLine,ParentCommandLine,Hashes
(index="virtuoso*" CommandLine="*\\ntdsutil*")
(index="virtuoso*" (CommandLine="<TAB>" OR CommandLine="^h^t^t^p" OR CommandLine="h\"t\"t\"p"))
(index="virtuoso*" (((Image="*\\wmic.exe") (CommandLine="wmic * *format:\\\"http*" OR CommandLine="wmic * /format:'http" OR CommandLine="wmic * /format:http*")) OR ((Imphash="1B1A3F43BF37B5BFE60751F2EE2F326E" OR Imphash="37777A96245A3C74EB217308F3546F4C" OR Imphash="9D87C9D67CE724033C0B40CC4CA1B206") (CommandLine="* *format:\\\"http*" OR CommandLine="* /format:'http" OR CommandLine="* /format:http*"))))
(index="virtuoso*" ParentImage="*\\WINWORD.EXE" Image="*\\FLTLDR.exe*")
(index="virtuoso*" (CommandLine="net group \"domain admins\" /domain" OR CommandLine="net localgroup administrators")) | table CommandLine,ParentCommandLine
(index="virtuoso*" NewProcessName="*\\bcdedit.exe" (ProcessCommandLine="*delete*" OR ProcessCommandLine="*deletevalue*" OR ProcessCommandLine="*import*"))
(index="virtuoso*" (CommandLine="*\\ping.exe 0x*" OR CommandLine="*\\ping 0x*")) | table ParentCommandLine
(index="virtuoso*" ParentImage="*\\taskmgr.exe" NOT ((Image="resmon.exe" OR Image="mmc.exe"))) | table Image,CommandLine,ParentCommandLine
(index="virtuoso*" ((ParentImage="*\\mshta.exe" OR ParentImage="*\\powershell.exe" OR ParentImage="*\\cmd.exe" OR ParentImage="*\\rundll32.exe" OR ParentImage="*\\cscript.exe" OR ParentImage="*\\wscript.exe" OR ParentImage="*\\wmiprvse.exe") (Image="*\\schtasks.exe" OR Image="*\\nslookup.exe" OR Image="*\\certutil.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\mshta.exe")) NOT (CurrentDirectory="*\\ccmcache\*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" ((((((((((((Image="*\\CamMute.exe" NOT (Image="*\\Lenovo\\Communication Utility\\*")) OR (Image="*\\chrome_frame_helper.exe" NOT (Image="*\\Google\\Chrome\\application\\*"))) OR (Image="*\\dvcemumanager.exe" NOT (Image="*\\Microsoft Device Emulator\\*"))) OR (Image="*\\Gadget.exe" NOT (Image="*\\Windows Media Player\\*"))) OR (Image="*\\hcc.exe" NOT (Image="*\\HTML Help Workshop\\*"))) OR (Image="*\\hkcmd.exe" NOT ((Image="*\\System32\\*" OR Image="*\\SysNative\\*" OR Image="*\\SysWowo64\\*")))) OR (Image="*\\Mc.exe" NOT ((Image="*\\Microsoft Visual Studio*" OR Image="*\\Microsoft SDK*" OR Image="*\\Windows Kit*")))) OR (Image="*\\MsMpEng.exe" NOT ((Image="*\\Microsoft Security Client\\*" OR Image="*\\Windows Defender\\*" OR Image="*\\AntiMalware\\*")))) OR (Image="*\\msseces.exe" NOT ((Image="*\\Microsoft Security Center\\*" OR Image="*\\Microsoft Security Client\\*" OR Image="*\\Microsoft Security Essentials\\*")))) OR (Image="*\\OInfoP11.exe" NOT (Image="*\\Common Files\\Microsoft Shared\\*"))) OR (Image="*\\OleView.exe" NOT ((Image="*\\Microsoft Visual Studio*" OR Image="*\\Microsoft SDK*" OR Image="*\\Windows Kit*" OR Image="*\\Windows Resource Kit\\*")))) OR (Image="*\\rc.exe" NOT ((Image="*\\Microsoft Visual Studio*" OR Image="*\\Microsoft SDK*" OR Image="*\\Windows Kit*" OR Image="*\\Windows Resource Kit\\*" OR Image="*\\Microsoft.NET\\*"))))) | table CommandLine,ParentCommandLine
(index="virtuoso*" ParentImage="*\\mshta.exe" (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\reg.exe" OR Image="*\\regsvr32.exe" OR Image="*\\BITSADMIN*")) | table CommandLine,ParentCommandLine
(index="virtuoso*" ParentImage="*\\svchost.exe" Image="*\\mshta.exe")
(index="virtuoso*" (CommandLine="cmd.exe /c *http://*%AppData%" OR CommandLine="cmd.exe /c *https://*%AppData%")) | table CommandLine,ParentCommandLine
(index="virtuoso*" (CommandLine="*\\AppData\\Roaming\\Oracle*\\java*.exe *" OR CommandLine="*cscript.exe *Retrive*.vbs *"))
(index="virtuoso*" extra.plaso.event_identifier="11" (TargetFilename="*\\AppData\\Roaming\\Oracle\\bin\\java*.exe" OR TargetFilename="*\\Retrive*.vbs"))
(index="virtuoso*" extra.plaso.event_identifier="13" TargetObject="\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run*" Details="%AppData%\\Roaming\\Oracle\\bin\\*")
(index="virtuoso*" ParentCommandLine="*\\svchost.exe*termsvcs" NOT (Image="*\\rdpclip.exe"))
(index="virtuoso*" CommandLine="* /dest:rdp-tcp:*")
(index="virtuoso*" (ParentImage="*\\mmc.exe" Image="*\\cmd.exe") NOT (CommandLine="*\\RunCmd.cmd")) | table CommandLine,ParentCommandLine
(index="virtuoso*" ((Image="*\\rundll32.exe") OR (Description="*Windows-Hostprozess (Rundll32)*")) (CommandLine="*Default.GetString*" OR CommandLine="*FromBase64String*"))
(index="virtuoso*" (CommandLine="* -NoP -sta -NonI -W Hidden -Enc *" OR CommandLine="* -noP -sta -w 1 -enc *"))
(index="virtuoso*" (CommandLine="netsh i* p*=3389 c*"))
(index="virtuoso*" (CommandLine="rasdial"))
(index="virtuoso*" (CommandLine="*\\rundll32.exe* url.dll,*OpenURL *" OR CommandLine="*\\rundll32.exe* url.dll,*OpenURLA *" OR CommandLine="*\\rundll32.exe* url.dll,*FileProtocolHandler *" OR CommandLine="*\\rundll32.exe* zipfldr.dll,*RouteTheCall *" OR CommandLine="*\\rundll32.exe* Shell32.dll,*Control_RunDLL *" OR CommandLine="*\\rundll32.exe javascript:*" OR CommandLine="* url.dll,*OpenURL *" OR CommandLine="* url.dll,*OpenURLA *" OR CommandLine="* url.dll,*FileProtocolHandler *" OR CommandLine="* zipfldr.dll,*RouteTheCall *" OR CommandLine="* Shell32.dll,*Control_RunDLL *" OR CommandLine="* javascript:*" OR CommandLine="*.RegisterXLL*"))
(index="virtuoso*" extra.plaso.event_identifier="13" (TargetObject="*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\\Debugger" OR TargetObject="*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe\\Debugger" OR TargetObject="*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\osk.exe\\Debugger" OR TargetObject="*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Magnify.exe\\Debugger" OR TargetObject="*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Narrator.exe\\Debugger" OR TargetObject="*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\DisplaySwitch.exe\\Debugger") EventType="SetValue")
(index="virtuoso*" (ParentImage="*\\winlogon.exe") (CommandLine="*cmd.exe sethc.exe *" OR CommandLine="*cmd.exe utilman.exe *" OR CommandLine="*cmd.exe osk.exe *" OR CommandLine="*cmd.exe Magnify.exe *" OR CommandLine="*cmd.exe Narrator.exe *" OR CommandLine="*cmd.exe DisplaySwitch.exe *"))
(index="virtuoso*" ((extra.plaso.event_identifier="12" TargetObject="*\\cmmgr32.exe*") OR (extra.plaso.event_identifier="13" TargetObject="*\\cmmgr32.exe*") OR (extra.plaso.event_identifier="10" CallTrace="*cmlua.dll*"))) | table CommandLine,ParentCommandLine,Details
(index="virtuoso*" ParentImage="*\\cmstp.exe") | table CommandLine,ParentCommandLine,Details
(index="virtuoso*" (extra.plaso.event_identifier="3" DestinationPort="3389") NOT ((Image="*\\mstsc.exe" OR Image="*\\RTSApp.exe" OR Image="*\\RTS2App.exe" OR Image="*\\RDCMan.exe" OR Image="*\\ws_TunnelService.exe" OR Image="*\\RSSensor.exe" OR Image="*\\RemoteDesktopManagerFree.exe" OR Image="*\\RemoteDesktopManager.exe" OR Image="*\\RemoteDesktopManager64.exe" OR Image="*\\mRemoteNG.exe" OR Image="*\\mRemote.exe" OR Image="*\\Terminals.exe" OR Image="*\\spiceworks-finder.exe" OR Image="*\\FSDiscovery.exe" OR Image="*\\FSAssessment.exe" OR Image="*\\MobaRTE.exe" OR Image="*\\chrome.exe")))
(index="virtuoso*" (extra.plaso.event_identifier="10" TargetImage="*\\verclsid.exe" GrantedAccess="0x1FFFFF") (CallTrace="*|UNKNOWN(*VBE7.DLL*" OR (SourceImage="*\\Microsoft Office\\*" CallTrace="*|UNKNOWN*")))
(index="virtuoso*" extra.plaso.event_identifier="8" SourceImage="*\\powershell.exe" TargetImage="*\\rundll32.exe")
(index="virtuoso*" extra.plaso.event_identifier="10" TargetImage="C:\\windows\\system32\\lsass.exe" GrantedAccess="0x1410")
